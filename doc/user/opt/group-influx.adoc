//----------------------------------------------------------------------------
//
// TSDuck - The MPEG Transport Stream Toolkit
// Copyright (c) 2005-2025, Thierry Lelegard
// BSD-2-Clause license, see LICENSE.txt file or https://tsduck.io/license
//
// Documentation for options in class ts::InfluxArgs.
//
// tags: short, prefix
//
//----------------------------------------------------------------------------

//---- ugly tag tricks ----

:opt-prefix:
// tag::prefix[]
:opt-prefix: influx-
// end::prefix[]

[.usage]
InfluxDB connection options

The InfluxDB server is identified with the same options
// tag::prefix[]
(with prefix `--{opt-prefix}`)
// end::prefix[]
as the `influx` command, the InfluxDB CLI, as documented at
https://docs.influxdata.com/influxdb/v2/reference/cli/influx/[docs.influxdata.com].

When retrieving credentials for InfluxDB, the following precedence apply:

[.compact-list]
. Command line flags (`--{opt-prefix}host`, `--{opt-prefix}org`, `--{opt-prefix}token`)
. Environment variables (`INFLUX_HOST`, `INFLUX_ORG`, `INFLUX_TOKEN`)
. CLI configuration file

[.opt]
// tag::short[]
*-c* _name_ +
// end::short[]
*--{opt-prefix}active-config* _name_

[.optdoc]
Config name to use in the InfluxDB CLI configurations file.

[.optdoc]
By default, use the environment variable `INFLUX_ACTIVE_CONFIG`,
then look for the "active" configuration in the configuration file,
or the first configuration if none is marked as active.

[.opt]
*--{opt-prefix}configs-path* _filename_

[.optdoc]
Path to the InfluxDB CLI configurations file.

[.optdoc]
By default, use the environment variable `INFLUX_CONFIGS_PATH`, then `$HOME/.influxdbv2/configs`.

[.opt]
// tag::short[]
*-b* _name_ +
// end::short[]
*--{opt-prefix}bucket* _name_

[.optdoc]
Name of the InfluxDB bucket.

[.optdoc]
By default, use the environment variable `INFLUX_BUCKET_NAME`.

[.opt]
*--{opt-prefix}bucket-id* _id_

[.optdoc]
Identifier of the InfluxDB bucket.
The _id_ must be a 16-character value.

[.optdoc]
By default, use the environment variable `INFLUX_BUCKET_ID`.

[.optdoc]
Only one of `--{opt-prefix}bucket` and `--{opt-prefix}bucket-id` shall be specified.
If none is specified, the environment variables are searched.
If the two values are specified in environment variables, the bucket id is used.

[.opt]
// tag::short[]
*-h* _name_ +
// end::short[]
*--{opt-prefix}host-url* _name_

[.optdoc]
Host name or URL of the InfluxDB server.
If a host name is used instead of a URL, `http:` is assumed.

[.optdoc]
By default, use the environment variable `INFLUX_HOST`, then the InfluxDB CLI configuration file.

[.opt]
// tag::short[]
*-o* _name_ +
// end::short[]
*--{opt-prefix}org* _name_

[.optdoc]
Name of the InfluxDB organization.

[.optdoc]
By default, use the environment variable `INFLUX_ORG`, then the InfluxDB CLI configuration file.

[.opt]
*--{opt-prefix}org-id* _id_

[.optdoc]
Identifier of the InfluxDB organization.
The _id_ must be a 16-character value.

[.optdoc]
By default, use the environment variable `INFLUX_ORG_ID`.

[.optdoc]
Only one of `--{opt-prefix}org` and `--{opt-prefix}org-id` shall be specified.
If none is specified, the environment variables are searched first, then the InfluxDB CLI configuration file.
If the two values are specified in a category of default values, the organization id is used.

[.opt]
// tag::short[]
*-t* _string_ +
// end::short[]
*--{opt-prefix}token* _string_

[.optdoc]
Token to authenticate InfluxDB requests.

[.optdoc]
By default, use the environment variable `INFLUX_TOKEN`, then the InfluxDB CLI configuration file.

[.usage]
InfluxDB additional options

[.opt]
*--{opt-prefix}queue-size* _count_

[.optdoc]
Maximum number of queued metrics between the plugin thread and the communication thread with InfluxDB.

[.optdoc]
Sending metrics data to the InfluxDB server means calling the Web API of the server and posting data through HTTP.
Depending on the response time of the server, this may introduce some delay in real-time streams.
To avoid this, the communication with the InfluxDB server is asynchronously performed in an independent thread.
The metrics data are queued between the plugin thread and the communication thread, without delaying the plugin thread.
The number of messages in that queue is limited to avoid memory exhaustion in case of communication problem.
When the queue becomes full, additional metrics are dropped.

[.optdoc]
On real-time streams, where metrics data are sent every few seconds, there is never more than one message in that queue.
However, on off-line streams which are processed at high speed (files for instance),
the metrics may be generated faster than they can be sent and the queue may grow.
Increase the queue size if some metrics are lost.

[.optdoc]
The default queue size is 10 messages.

[.opt]
*--{opt-prefix}tag* _name=value_

[.optdoc]
Add the specified tag `name`, with the specified `value`, to all metrics which are sent to InfluxDB.
This can be used to identify a source of metrics and filter it using Flux queries.

[.optdoc]
Several `--{opt-prefix}tag` options may be specified.
