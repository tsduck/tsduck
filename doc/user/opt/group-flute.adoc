//----------------------------------------------------------------------------
//
// TSDuck - The MPEG Transport Stream Toolkit
// Copyright (c) 2005-2026, Thierry Lelegard
// BSD-2-Clause license, see LICENSE.txt file or https://tsduck.io/license
//
// Documentation for options in class ts::FluteDemuxArgs and subclasses.
//
// tags: dvbnip flute
//
//----------------------------------------------------------------------------

//---- ugly tag tricks ----

:opt-base: true
:!opt-dvbnip:
:!opt-flute:

// tag::dvbnip[]
:!opt-base:
:opt-dvbnip: true
// end::dvbnip[]

// tag::flute[]
:!opt-base:
:opt-flute: true
// end::flute[]

//---- end of tag tricks ----

//----------------------------------------------------------------------------
// FLUTE / NIP title
//----------------------------------------------------------------------------

ifdef::opt-base[]
[.usage]
FLUTE protocol options
endif::[]

ifdef::opt-dvbnip[]
[.usage]
DVB-NIP analysis options

These options are identical in the command `tsnip` and the `tsp` plugin `nip`.
endif::[]

ifdef::opt-flute[]
[.usage]
FLUTE analysis options

These options are identical in the command `tsflute` and the `tsp` plugin `flute`.
endif::[]

//----------------------------------------------------------------------------
// option --destination
//----------------------------------------------------------------------------

ifdef::opt-flute[]
[.opt]
*-d* _[ip-address]:[port]_ +
*--destination* _[ip-address]:[port]_

[.optdoc]
Only use UDP packets with the specified destination IP address and/or UDP port.

[.optdoc]
Multiple options `--destination` can be specified. By default, use all UDP packets.
endif::[]

//----------------------------------------------------------------------------
// Common FLUTE options
//----------------------------------------------------------------------------

[.opt]
*--dump-flute-payload*

[.optdoc]
Same as `--log-flute-packets` and also dump the payload of each FLUTE packet.

[.opt]
*--dump-xml-files*

[.optdoc]
Dump the content of XML files when they are received.

//----------------------------------------------------------------------------
// Option --extract-carousel
//----------------------------------------------------------------------------

ifdef::opt-flute[]
[.opt]
*--extract-carousel* _directory-name_

[.optdoc]
Save all files in the FLUTE carousel. The specified path is a directory.
The file hierarchy is recreated from this directory.

[.optdoc]
When a FLUTE file name is an URI, the URI scheme is removed.
The characters which are not allowed in file names are replaced with an underscore.
endif::[]

//----------------------------------------------------------------------------
// Common FLUTE options
//----------------------------------------------------------------------------

[.opt]
*--extract-destination* _[ip-address]:[port]_

[.optdoc]
With `--extract-file`, specify the destination IP address and/or UDP port of files.
By default, extract the files with matching name and any IP destination.

[.opt]
*-e* _name-or-urn_ +
*--extract-file* _name-or-urn_

[.optdoc]
Extract the specified file from the FLUTE carousel.
The _name-or-urn_ shall be the exact complete name of the file, as identified in the FDT.

[.optdoc]
The option `--extract-file` can be specified several times.
All files are extracted in the output directory which is specified in option `--output-directory`.
The output base name of each file is the last part of the _name-or-urn_, after the last slash or colon.

[.opt]
*--extract-source* _ip-address_

[.optdoc]
With `--extract-file`, specify the source IP address of files.
By default, extract the files with matching name and any IP source address.

[.opt]
*--extract-tsi* _value_

[.optdoc]
With `--extract-file`, specify the Transport Session Identifier (TSI) of files.
By default, extract the files with matching name and any TSI.

[.opt]
*--log-fdt*

[.optdoc]
Log a message describing each FLUTE File Delivery Table (FDT).

[.opt]
*--log-files*

[.optdoc]
Log a message describing each received file.

[.opt]
*--log-flute-packets*

[.optdoc]
Log a message describing the structure of each FLUTE packet.

[.opt]
*--max-file-size* _value_

[.optdoc]
Maximum size of files in the FLUTE carousel to analyze or extract.
Each received file is accumulated in memory, chunk by chunk, until the file is complete.
After processing the file, all chunks are freeed.
This option is useful when the stream contains many large files which clutter the memory during their reception.
All files which are announced as larger than the specified size are ignored.

[.optdoc]
By default, all files are received and analyzed or saved.

//----------------------------------------------------------------------------
// option --output-directory
//----------------------------------------------------------------------------

[.opt]
*-d* _directory-name_ +
*--output-directory* _directory-name_

[.optdoc]
Output directory for files which are extracted using option `--extract-file`.

[.optdoc]
The default is the current directory.

//----------------------------------------------------------------------------
// option --output-file
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*-o* _file-name_ +
*--output-file* _file-name_

[.optdoc]
With `--summary`, save the report in the specified file.
By default or if the specified path is '`-`', the report is written to the standard output.
endif::[]

ifdef::opt-flute[]
[.opt]
*-o* _file-name_ +
*--output-file* _file-name_

[.optdoc]
With `--summary`, save the report in the specified file.
By default or if the specified path is '`-`', the report is written to the standard output.
endif::[]

//----------------------------------------------------------------------------
// option --save-bootstrap
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--save-bootstrap* _file-name_

[.optdoc]
Save the bootstrap multicast gateway configuration in the specified file.
This is a XML file.
If the specified path is '`-`', the file is written to standard output.
endif::[]

//----------------------------------------------------------------------------
// option --save-dvb-gw
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--save-dvb-gw* _directory-name_

[.optdoc]
Save all files in the DVB-NIP carousel with URI starting with `http://dvb.gw/`.
The specified path is a directory.
The file hierarchy is recreated from this directory.

[.optdoc]
Example: with `--save-dvb-gw /save/to`, the file `http://dvb.gw/operator.com/materials/f.jpg`
is saved as `/save/to/operator.com/materials/f.jpg`.
endif::[]

//----------------------------------------------------------------------------
// option --save-fdt (common)
//----------------------------------------------------------------------------

[.opt]
*--save-fdt* _file-name_

[.optdoc]
Save each FLUTE File Delivery Table (FDT) in a file.
Each FDT instance is saved in a separate file.
If the specified path is `dir/fdt.xml` for instance, the FDT with instance `N` is saved in file `dir/fdt-N.xml`.
If the specified path is '`-`', the file is written to standard output.

//----------------------------------------------------------------------------
// option --save-nif
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--save-nif* _file-name_

[.optdoc]
Save the DVB-NIP Network Information File (NIF) in the specified file.
This is a XML file.
If the specified path is '`-`', the file is written to standard output.
endif::[]

//----------------------------------------------------------------------------
// option --save-nip
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--save-sif* _file-name_

[.optdoc]
Save the DVB-NIP Service Information File (SIF) in the specified file.
This is a XML file.
If the specified path is '`-`', the file is written to standard output.
endif::[]

//----------------------------------------------------------------------------
// option --save-slep
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--save-slep* _file-name_

[.optdoc]
Save the DVB-I Service List Entry Points (SLEP) in the specified file.
This is a XML file.
If the specified path is '`-`', the file is written to standard output.
endif::[]

//----------------------------------------------------------------------------
// option --strict
//----------------------------------------------------------------------------

[.opt]
*--strict*

[.optdoc]
Apply a strict interpretation of protocols.
By default, non-fatal misusages of the protocols are ignored.

//----------------------------------------------------------------------------
// option --summary
//----------------------------------------------------------------------------

ifdef::opt-dvbnip[]
[.opt]
*--summary*

[.optdoc]
Display a summary of the DVB-NIP session.
This is the default if no other option is specified.
endif::[]

ifdef::opt-flute[]
[.opt]
*--summary*

[.optdoc]
Display a summary of the FLUTE session.
This is the default if no other option is specified.
endif::[]
